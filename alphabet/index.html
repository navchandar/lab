<!DOCTYPE html>
<html lang="en" class="">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alphabet Generator</title>
    <meta name="description" content="A simple interactive Alphabet Generator that changes color on key press or tap.">
    <meta name="keywords"
        content="alphabet, english letters, flash, colors, increment, interactive, JavaScript, mobile-friendly">
    <meta name="author" content="Naveenchandar">
    <meta property="og:title" content="Alphabet Generator">
    <meta property="og:description"
        content="A fun and responsive Alphabet Generator that changes color with each interaction.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://navchandar.github.io/lab/alphabet">
    <meta property="og:image" content="https://navchandar.github.io/lab/alphabet/preview.gif">
    <style>
        body {
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #4e4e4e;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }

        #number {
            /* Center the number within this container */
            display: flex;
            justify-content: center;
            align-items: center;

            font-size: 15em;
            color: black;
            user-select: none;
            cursor: pointer;
            -webkit-text-stroke: 2px #333;
            text-shadow: 4px 4px 8px rgba(0, 0, 0, 0.5);
            line-height: 1;

            /* Paper-like background styles */
            background-color: lightgrey;
            background-image:
                repeating-linear-gradient(0deg,
                    #eee 0.5px,
                    transparent 0.5px,
                    transparent 20px),
                repeating-linear-gradient(180deg,
                    #000 0.1px,
                    transparent 0.5px,
                    transparent 20px);
            background-size: 20px 20px;
            box-shadow:
                0 1px 1px rgba(0, 0, 0, 0.1),
                0 8px 16px rgba(0, 0, 0, 0.3);
            border-radius: 10px 40px 40px 10px;
            position: relative;
            overflow: hidden;
            transition: color 0.4s ease;
        }

        /* Styles for the mute button */
        #muteButton {
            position: fixed;
            /* Fixed position relative to the viewport */
            bottom: 20px;
            /* 20px from the bottom */
            right: 20px;
            /* 20px from the right */
            background-color: #6c757d;
            /* Grayish button */
            color: white;
            border: none;
            border-radius: 50%;
            /* Make it a circle */
            width: 50px;
            height: 50px;
            font-size: 1.5em;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transition: background-color 0.3s ease;
        }

        #muteButton:hover {
            background-color: #5a6268;
        }

        /* Styles for mobile devices */
        @media (max-width: 767px) {
            #number {
                width: 250px;
                height: 400px;
                font-size: 8em;
                -webkit-text-stroke: 1px #333;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            }

            #muteButton {
                width: 40px;
                height: 40px;
                font-size: 1.2em;
                bottom: 10px;
                right: 10px;
            }
        }

        /* Styles for desktop */
        @media (min-width: 768px) {
            #number {
                width: 600px;
                height: 720px;
                font-size: 18em;
                -webkit-text-stroke: 3px #333;
                text-shadow: 6px 6px 12px rgba(0, 0, 0, 0.75);
            }
        }
    </style>
</head>

<body>

    <div id="number" style="color: lightgray;" aria-label="Current letter">A</div>

    <button id="muteButton" aria-label="Toggle mute" disabled title="Toggle sound"></button>


    <script src="data.js"></script>
    <script>
        // =========================
        // Initialization
        // =========================
        const urlParams = new URLSearchParams(window.location.search);
        const lang = urlParams.get('lang')?.toLowerCase() || 'english';
        const languageData = window.alphabets[lang] || window.alphabets.english;        
        const Alphabet = languageData.chars;
        const Locale = languageData.locale;

        let currentColor = null;
        let previousColor = null;
        let isMuted = localStorage.getItem('isMuted') === 'true';

        let retryCount = 0;
        const maxRetries = 10;


        const numberElement = document.getElementById('number');
        const muteButton = document.getElementById('muteButton');
        const colors = ["red", "blue", "green", "white", "orange", "brown", "pink", "yellow"];

        let currentAlphabet = Alphabet[0];
        numberElement.textContent = currentAlphabet;

        // Set initial mute button icon based on the loaded state
        muteButton.textContent = isMuted ? 'ðŸ”‡' : 'ðŸ”Š';
        // Initial mute button state
        muteButton.disabled = true;
        muteButton.title = "Setting up Speech Synthesis...";

        // =========================
        // Speech Synthesis Setup
        // =========================
        const synth = window.speechSynthesis;
        let utterance = null;

        if (!synth || typeof SpeechSynthesisUtterance === 'undefined') {
            console.warn("Web Speech API is not supported in this browser.");
            muteButton.style.display = 'none';
            window.speaker = () => console.warn("Speech API not available.");
        } else {
            // Initialize utterance only if supported
            utterance = new SpeechSynthesisUtterance();
            let availableVoices = [];


            function populateVoiceList() {
                let voices = synth.getVoices();

                if (!voices || !voices.length) {
                    if (retryCount < maxRetries) {
                        retryCount++;
                        setTimeout(populateVoiceList, 100);
                    } else {
                        console.warn("Failed to load voices after multiple attempts.");
                        muteButton.disabled = true;
                        muteButton.title = "Speech not available";
                    }
                    return;
                }

                availableVoices = voices.sort((a, b) => a.name.localeCompare(b.name));
                console.log("Available voices:", availableVoices.map(v => `${v.name} (${v.lang})`));

                let preferredVoice = availableVoices.find(voice =>
                    voice.lang === Locale &&
                    ["Google", "Microsoft", "Apple", "Samantha", "Monica", "Zira", "David"]
                        .some(name => voice.name.includes(name))
                );

                if (!preferredVoice) {
                    const langPrefix = preferredLocale.split('-')[0]; 
                    preferredVoice = availableVoices.find(v => v.lang.startsWith(langPrefix)) ||
                        availableVoices.find(v => v.lang.startsWith('en')) ||
                        availableVoices[0];
                }

                if (preferredVoice) {
                    utterance.voice = preferredVoice;
                    utterance.lang = preferredVoice.lang;
                    console.log("Set default voice to:", preferredVoice.name, preferredVoice.lang);
                    muteButton.disabled = false;
                    muteButton.title = "Toggle sound";
                } else {
                    console.warn("No suitable voice found.");
                }
            }

            populateVoiceList();
            if (synth.onvoiceschanged !== undefined) {
                synth.onvoiceschanged = populateVoiceList;
            }
        }

        // =========================
        // Utility Functions
        // =========================
        function getNewColor() {
            let newColor;
            do {
                newColor = colors[Math.floor(Math.random() * colors.length)];
            } while (newColor === currentColor || newColor === previousColor);
            return newColor;
        }

        function speaker() {
            if (utterance && !isMuted) {
                if (synth.speaking) synth.cancel();
                utterance.text = numberElement.textContent.toLowerCase();
                try {
                    synth.speak(utterance);
                } catch (error) {
                    console.error("Error speaking:", error);
                }
            } else if (!utterance) {
                console.warn("Speech API not initialized. Cannot speak.");
            }
        }

        function toggleMute() {
            isMuted = !isMuted;
            localStorage.setItem('isMuted', isMuted);
            muteButton.textContent = isMuted ? 'ðŸ”‡' : 'ðŸ”Š';
            if (isMuted && synth.speaking) synth.cancel();
            if (!isMuted) speaker();
        }

        let currentIndex = 0;
        function incrementAlphabet() {

            if (currentIndex >= selectedAlphabet.length) {
                currentIndex = 0;
            }

            const newChar = Alphabet[currentIndex];
            numberElement.textContent = newChar;
            currentIndex++;


            previousColor = currentColor;
            currentColor = getNewColor();
            numberElement.style.color = currentColor;

            speaker();
        }


        // =========================
        // Event Listeners
        // =========================
        document.addEventListener('keydown', event => {
            if (event.code === 'Space' || event.code === 'Enter') {
                event.preventDefault();
                incrementAlphabet();
            } else if (event.code === 'KeyM') {
                event.preventDefault();
                toggleMute();
            }
        });

        document.body.addEventListener('click', incrementAlphabet);
        document.body.addEventListener('touchstart', e => {
            e.preventDefault();
            incrementAlphabet();
        }, { passive: false });

        muteButton.addEventListener('click', e => {
            e.stopPropagation();
            toggleMute();
        });

        muteButton.addEventListener('touchstart', e => {
            e.preventDefault();
            e.stopPropagation();
            toggleMute();
        }, { passive: false });
    </script>


</body>

</html>